<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ape Fools NFT Mint</title>
    <style>
        button:disabled {
            border: 1px solid #999999 !important;
            background-color: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
        }
    </style>
    <script src="ethers.umd.js" type="application/javascript"></script>
</head>

<body>
    <button id="connectButton">Connect Wallet</button>
    <button id="switchNetworkButton" style="display: none;">Switch to Base Sepolia</button>
    <span id="walletAddress" style="display: none;"></span>
    <div id="contents">
        <h1>Ape Fools</h1>
        <h2>Mint your NFT on the Base Sepolia Testnet</h2>
        <p>First NFT mint for each wallet is <b><i>Free!</i></b></p>
        <label for="mintAmount">Choose amount to mint</label>
        <input type="number" id="mintAmount" min="1" max="5" value="1">
        <button id="mintButton">Mint NFT</button>
        <div id="status"></div>
    </div>

    <script>
        // Define global variables for frequently used DOM elements and contract
        const connectButton = document.getElementById("connectButton");
        const switchNetworkButton = document.getElementById("switchNetworkButton");
        const walletAddress = document.getElementById("walletAddress");
        const mintAmount = document.getElementById("mintAmount");
        const mintButton = document.getElementById("mintButton");
        const status = document.getElementById("status");

        const contractAddress = "0xb741C2f06FA5b7aD042Eae5c78B3A3f13A40a8fA";
        let contract;

        async function connect() {
            if (typeof window.ethereum !== "undefined") {
                await ethereum.request({ method: "eth_requestAccounts" });
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const address = await signer.getAddress();
                walletAddress.innerHTML = "Connected: " + address;
                walletAddress.style.display = "inline";
                connectButton.style.display = "none";
                const network = await provider.getNetwork();
                if (network.chainId !== 84531) {
                    switchNetworkButton.style.display = "inline";
                }
                contract = new ethers.Contract(contractAddress, contractABI, signer);
            } else {
                status.innerHTML = "Please install MetaMask";
            }
        }

        async function switchNetwork() {
            if (typeof window.ethereum !== "undefined") {
                try {
                    await ethereum.request({
                        method: "wallet_switchEthereumChain",
                        params: [{ chainId: "0x14A3B" }],
                    });
                } catch (error) {
                    if (error.code === 4902) {
                        await ethereum.request({
                            method: "wallet_addEthereumChain",
                            params: [
                                {
                                    chainId: "0x14A3B",
                                    rpcUrls: ["https://sepolia.base.org"],
                                    chainName: "Base Sepolia",
                                    nativeCurrency: { name: "Sepolia ETH", symbol: "ETH", decimals: 18 },
                                    blockExplorerUrls: ["https://sepolia.etherscan.io"],
                                },
                            ],
                        });
                    }
                }
            }
        }

        async function mint() {
            const mintAmountValue = mintAmount.value;
            if (contract) {
                try {
                    const response = await contract.mint(mintAmountValue, {
                        value: ethers.utils.parseEther("0.001"),
                    });
                    await response.wait();
                    status.innerHTML = "Minted!";
                } catch (error) {
                    status.innerHTML = "Error: " + error.message;
                }
            } else {
                status.innerHTML = "Please connect wallet first.";
            }
        }

        connectButton.onclick = connect;
        switchNetworkButton.onclick = switchNetwork;
        mintButton.onclick = mint;
    </script>
</body>

</html>
